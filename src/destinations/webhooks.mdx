---
title: Webhook destinations
---

For more information on destinations, see the [Destinations](/destinations) page.

When new data is read from a SaaS instance via a [Read Action](/define-integrations/read-actions), Ampersand sends a payload to your configured webhook.

### OpenAPI spec

Check out our [OpenAPI spec](https://github.com/amp-labs/openapi/blob/main/webhook/webhook.yaml) for the full webhook message schema and more details on the data structure. You can use this to generate types for your language and easily parse the webhook message.

# When a record is too big
Ampersand attaches results to a webhook message in two ways:

1) **Inline**: In most cases, the result is directly included in the webhook's `result` field.
2) **URL**: If a single record is over 300KB, it becomes too big to be sent over a webhook. In this case, the result won't be included inline. Instead, the webhook message will contain a signed download URL in `resultInfo.downloadUrl`. **The URL expires after 15 minutes.**

`resultInfo.type` indicates how the result is attached to the message:

If type is `inline`, the full result is in the `result` field.
If type is `url`, you can fetch the full result by making a GET request to `resultInfo.downloadUrl`.

In both cases, `resultInfo.numRecords` tells you how many records are available in the result.


### Example webhook message (inline)

Here's a sample webhook message for a Salesforce Contact object:

```JavaScript JavaScript
{
  "projectId": "ampersand-project-id",
  "provider": "salesforce",
  "groupRef": "xyz-company",
  "groupName": "XYZ Company",
  "installationId": "installation-id",
  "objectName": "Contact",
  // Only certain providers will have workspace available.
  "workspace": "salesforce-subdomain",
  "resultInfo": {
    "type": "inline",
    "numRecords": 2
  },
  "result": [
    {
      "fields": {
        "id": "001Dp00000P8QurIAF",
        "firstname": "Sally",
        "lastname": "Jones"
      },
      "mappedFields": {
        "pronoun": "she"
      },
      "raw": {
        "id": "001Dp00000P8QurIAF",
        "firstname": "Sally",
        "lastname": "Jones",
        "pronoun_custom_field": "she"
        // ... other fields for this record
      }
    },
    {
      "fields": {
        "id": "001Dp00000P9BusEIS",
        "firstname": "Taylor",
        "lastname": "Lao"
      },
      "mappedFields": {
        "pronoun": "they"
      },
      "raw": {
        "id": "001Dp00000P9BusEIS",
        "firstname": "Taylor",
        "lastname": "Lao",
        "pronoun_custom_field": "they"
        // ... other fields for this record
      }
    }
  ]
}
```

### Example webhook message (URL)

```JavaScript JavaScript
{
  "projectId": "ampersand-project-id",
  "provider": "salesforce",
  "groupRef": "xyz-company",
  "groupName": "XYZ Company",
  "installationId": "installation-id",
  "objectName": "Contact",
  // Only certain providers will have workspace available.
  "workspace": "salesforce-subdomain",
  "resultInfo": {
    "type": "url",
    "downloadUrl": "https://storage.googleapis.com/....",
    "numRecords": 1
  },
}
```


## Handling webhook results

Here's some pseudo-code to illustrate how you can get parse result from a webhook:

```go go
// Generated from the OpenAPI spec
type WebhookMessage struct {
	Action string `json:"action"`
	GroupName string `json:"groupName"`
	GroupRef string `json:"groupRef"`
     ...
}

func handleWebhookEndpointMessage(message WebhookMessage) {
  // Assumes that you have already parsed the webhook message into the openapi.WebhookMessage type

  var results map[string]any

  switch message.ResultInfo.Type {
    case "url":
      // If result type is "url", download the data
      res, err := http.Get(message.ResultInfo.DownloadUrl)
      if err != nil {
        // handle error
      }

      results = parseBodyIntoMap(res.Body)
    case "inline":
      // If result type is "inline", data is directly in the message
      results = message.Result

    default:
      // This should not happen - contact us if it does!
  }

  fmt.Printf("Received %d records", message.ResultInfo.NumRecords)

  // Process results as needed
}
```

# Ensure your destination can handle the payload size

The maximum size of a webhook payload Ampersand may send to your destination is **300 KB**. Most API gateways can handle this by default. If you implement your webhook using AWS Lambda or Google Cloud Run Functions, they will also be able to handle this payload size by default.

If you are using the Node.js framework [Express](https://expressjs.com) in your webhook receiver, and are using the [json middleware](https://expressjs.com/en/api.html#express.json) to parse request bodies, you will need to modify it to increase the maximum request body size.


```js
  const app = express();

  app.use([
    express.json({
      limit: "350kb", // Set the max to 350 KB to allow for some buffer.
    }),
  ]);
```

## Delivery modes

### Auto
This is the default delivery mode if you do not specify a delivery mode. When you set the delivery mode to `auto`, Ampersand will automatically send results to your destination as it reads new data from the SaaS instance.

### On request

When you set the delivery mode to `onRequest`, Ampersand will not send webhooks as it reads new data, but only when you request for more results. This is useful when you want to control the rate at which you receive data. For precise control over how much data you receive, you can configure the page size, which specifies the number of records to send in each webhook payload.

Please note that the page size is a *maximum*, and the actual number of records in each payload may be lesser if there are fewer records available in the SaaS instance. Currently, the minimum page size is 50, and the maximum is 500. Please reach out to us if you need this to be lower or higher.


Here's an example of how to configure the delivery mode to `onRequest` for a Salesforce Contact object, with a page size of 50 records per webhook message:

```yaml yaml
specVersion: 1.0.0
integrations:
  - name: salesforce-buffered-read
    provider: salesforce
    read:
      objects:
        - objectName: contact
          destination: contactWebhook
          schedule: "*/30 * * * *" # Data will be read every 30 minutes
          delivery:
            mode: onRequest
            pageSize: 50
```

#### Requesting results
When you are ready to receive & process webhook messages, you can call [Deliver results on request](/reference/read/deliver-results-on-request), which will asynchronously send the stored results to the configured destination. Each webhook message will contain the next set of records based on the page size you configured.

For example, if you are ready to receive & process a maximum of 300 records with a configured `pageSize` of 50 in your `amp.yaml`, you should ask for 300 / 50, i.e. 6 pages of results from the above endpoint.

#### What happens if you request for more pages than are available?

If you request for more pages than are available, Ampersand will first send you all the available records at the time of your request. Then, as it reads new data, it will send you the new records as they become available until you have received your requested number of pages.

For example, if you have a read action running every hour, and you request for 10 pages of results, but there are only 4 pages available at the time of your request, Ampersand will send you the 4 pages immediately. If Ampersand reads 20 pages of results in the next scheduled read action, Ampersand will send you 6 pages more, resulting in a total of 10 pages of results being delivered. The balance of 14 pages will again be available for delivery upon request.
