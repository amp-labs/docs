---
title: "Salesforce External Client Apps"
---

export const Terminal = ({copyText, command, output}) => {
  const copyCommand = async () => {
    await navigator.clipboard.writeText(copyText);
  };

  let commandComponent =
    <div className="flex items-start px-3 py-2">
      <span className="text-green-400 pr-2">$</span>
      <span className="flex-1 break-words whitespace-pre-wrap">{command}</span>
      <button
        onClick={copyCommand}
        className="ml-2 text-gray-400 hover:text-white text-xs"
        title="Copy command">Copy
      </button>
    </div>

  let outputComponent =
    <div className="px-3 py-2 text-sm whitespace-pre-wrap overflow-x-auto bg-gray-950 rounded-md font-mono">
      {output}
    </div>

  return (
    <div
      className="terminal bg-gray-900 text-gray-100 font-mono text-sm rounded-md border border-gray-800 max-w-3xl mx-auto">
      {commandComponent}
      {output && outputComponent}
    </div>
  );
};

# Overview

This guide explains how **Ampersand Builders (ISVs)** create, package, version, and distribute **Salesforce External Client Apps (ECAs)** so their **Consumers** can securely authorize OAuth integrations.
Builders create ECAs in Salesforce, extract the app's metadata into a **Salesforce DX (sf)** project, and distribute it using **Second-Generation Managed Packaging (2GP)**.
Consumers install the released package into their own orgs and can upgrade it over time without reinstallation.
This workflow establishes the Builder as the long-term owner of the OAuth client lifecycle.

## Core Concepts

As a Builder, you will work with:

- **External Client Apps (ECA)** -- OAuth clients managed as Salesforce metadata
- **Salesforce CLI (`sf`)** -- required for Salesforce Developer Experience (DX) projects, metadata retrieval, and packaging
- **Dev Hub org** -- owns all managed packages you create
- **Namespace org** -- a separate Developer Edition used only to register a namespace
- **2GP Managed Packages** -- the distribution and versioning mechanism
- **Consumers** -- customer orgs that install and upgrade your released package

## Salesforce Organizations

You will operate across **three Salesforce orgs**, each with a fixed role:

1. **Dev Hub (Builder)**
Developer Edition with **Dev Hub enabled**.
Owns all managed packages and package versions.

2. **Namespace Org (Builder)**
Separate Developer Edition.
Used only to register a **namespace** and **link it** to the Dev Hub.

3. **Subscriber Org (Consumer)**
Your customer's org (scratch, sandbox, or production).
Installs your released package and uses the ECA for OAuth.

> âš ï¸ Builders must use **two separate orgs**: one as a Dev Hub and one for namespace registration.
> These roles **cannot be combined or changed later**.

# Preparation Stage

This stage establishes irreversible Salesforce account configurations.
Complete it once and deliberately before creating any External Client Apps.

## Step 1 - Enable Dev Hub
Enable [Dev Hub and Second-Generation Managed Packaging](https://developer.salesforce.com/docs/atlas.en-us.pkg2_dev.meta/pkg2_dev/sfdx_pkg_enable_devhub.htm) in your chosen Builder org:
1. Log in to your Salesforce org.
2. From **Setup**, enter **Dev Hub** in the Quick Find box and select **Dev Hub**.
    * If Dev Hub does not appear, verify that your org is a supported edition.
3. Select **Enable Dev Hub**.
    * **âš  It cannot be disabled.**
4. Select Enable Unlocked Packages and Second-Generation Managed Packages.
    * **âš  This setting is also permanent.**

![Enable Dev Hub](/images/customer-guides/salesforce-eca/enable-dev-hub.png)

**Why this matters?**
> After you enable the Dev Hub setting on a Salesforce org, that Dev Hub becomes the owner of every managed 2GP package you create.
> All Salesforce ISV and OEM partners should designate their Partner Business Org (PBO) as their Dev Hub org.
> If you plan to create package versions or run continuous integration jobs, itâ€™s better to use your PBO as your Dev Hub because of higher scratch org and package version limits.

## Step 2 - Register a namespace
Namespaces cannot be created in a Dev Hub org.
Use a separate Developer Edition org (which will never be enabled as a Dev Hub) to register your namespace.
This namespace will be used by all managed packages created from your Dev Hub.

[Create and register your namespace](https://developer.salesforce.com/docs/atlas.en-us.pkg2_dev.meta/pkg2_dev/sfdx_dev_dev2gp_create_namespace.htm):
1. Sign up for a new **Developer Edition** org.
2. In **Setup**, enter **Package Manager** in the Quick Find box and select **Package Manager**.
3. In **Namespace Settings**, click **Edit**.
4. Enter a namespace and select **Check Availability**.
5. (Optional) Select a package to associate with this namespace, or select **None**, then click **Review**.
6. Review your selections and click **Save**.

![Create Namespace](/images/customer-guides/salesforce-eca/create-namespace.png)

## Step 3 - Link namespace to Dev Hub
Salesforce session handling is unreliable during namespace linking. Use an incognito browser window.

[Link a Namespace to a Dev Hub Org](https://developer.salesforce.com/docs/atlas.en-us.260.0.sfdx_dev.meta/sfdx_dev/sfdx_dev_reg_namespace.htm):
* Log in to the **Dev Hub** org
* Open **App Launcher** (9 dots) â†’ **Namespace Registries**
* Click **Link Namespace**
* When prompted to authenticate, log in using the org which has a **namespace**
* After linking, select **All Namespace Registries** filter to view the namespace.

![Link namespace](/images/customer-guides/salesforce-eca/link-namespace.png)

![View namespaces](/images/customer-guides/salesforce-eca/view-all-namespaces.png)

## Step 4 - Install Salesforce CLI
The Salesforce CLI is required for all remaining steps: DX projects, metadata retrieval, packaging, versioning, and installation.

See all options to [Install Salesforce CLI](https://developer.salesforce.com/docs/atlas.en-us.260.0.sfdx_setup.meta/sfdx_setup/sfdx_setup_install_cli.htm#sfdx_setup_install_cli)
or use npm:
```bash
npm install @salesforce/cli --global
```

# Create External Client App
* Open **Setup** and search for **External Client App Manager**. Or follow the path **Setup** > **Apps** > **External Client Apps** > **External Client App Manager**.
* Click **New External Client App**.

![New ECA](/images/customer-guides/salesforce-eca/new-app.png)

* Enter a **name** for the External Client App. Tutorial example: **Neptune**.
* Specify required **contact email**.
* Set **Distribution State** to **"Packaged"**.
* Enable **Oauth settings**.
* Paste **callback URLs** separated by new lines.
* Configure the **Oauth scopes**.
* Disable **PKCE requirement** and enable **authorization code** flow.

![Create ECA](/images/customer-guides/salesforce-eca/create-app.gif)

At this point, the External Client App is created in Salesforce and **ready for packaging**.

# Salesforce DX Project

* You should start with no authenticated Salesforce orgs.

<Terminal
  command={"sf org list"}
  copyText={"sf org list"}
  output={
    <>
      No Orgs found.{"\n"}
      {"\n"}
      Legend: ğŸŒ³=Default DevHub, ğŸ=Default Org Use --all to see expired and deleted scratch orgs{"\n"}
    </>}></Terminal>

* Authenticate your **Dev Hub account**. You must provide an alias. Specifying the full instance URL is optional.

<Terminal
  command={"sf org login web -d -a CobaltOrg \\\n  --instance-url https://myself86-dev-ed.develop.my.salesforce.com/"}
  copyText={"ORG_ALIAS=CobaltOrg; WORKSPACE=myself86-dev-ed.develop; sf org login web -d -a $ORG_ALIAS --instance-url https://$WORKSPACE.my.salesforce.com/"}
  output={
    <>
      Successfully authorized ******@gmail.com with org ID 00Dak0000094BCbEAM{"\n"}
    </>
  }></Terminal>


* Create a new Salesforce **DX project** on your local machine.

<Terminal
  command={"sf project generate --name CobaltProject; cd CobaltProject/"}
  copyText={"PROJECT=CobaltProject; sf project generate --name $PROJECT; cd \"$PROJECT/\""}
  output={
    <>
      target dir = /home/cobalt/ampersand{"\n"}
      {"\t"}create CobaltProject/config/project-scratch-def.json{"\n"}
      {"\t"}create CobaltProject/README.md{"\n"}
      {"\t"}create CobaltProject/sfdx-project.json{"\n"}
      {"\t"}create CobaltProject/.husky/pre-commit{"\n"}
      {"\t"}create CobaltProject/.vscode/extensions.json{"\n"}
      {"\t"}create CobaltProject/.vscode/launch.json{"\n"}
      {"\t"}create CobaltProject/.vscode/settings.json{"\n"}
      {"\t"}create CobaltProject/eslint.config.js{"\n"}
      {"\t"}create CobaltProject/scripts/soql/account.soql{"\n"}
      {"\t"}create CobaltProject/scripts/apex/hello.apex{"\n"}
      {"\t"}create CobaltProject/.forceignore{"\n"}
      {"\t"}create CobaltProject/.gitignore{"\n"}
      {"\t"}create CobaltProject/.prettierignore{"\n"}
      {"\t"}create CobaltProject/.prettierrc{"\n"}
      {"\t"}create CobaltProject/jest.config.js{"\n"}
      {"\t"}create CobaltProject/package.json{"\n"}
    </>
  }></Terminal>

* Initialize Git immediately to track all changes.

<Terminal
  command={"git init && git add . && git commit -m \"initial commit\""}
  copyText={"git init && git add . && git commit -m \"initial commit\""}></Terminal>

# Salesforce DX Packaging

This is where Salesforce DX becomes essential.

The `force-app` directory contains Salesforce metadata.
Everything in this directory will be included in the managed package.

A **package** is simply a versioned collection of metadata files.
You will use Git and Salesforce package versions together to track and ship changes.

Since we [previously created an External Client App](/customer-guides/salesforce-eca#create-external-client-app) named **Neptune**,
the next step is to retrieve its metadata into the DX project.

Salesforce exposes many metadata types. You can explore the complete list here: [Reference](https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_types_list.htm).

* Download [ExternalClientApplication](https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_externalclientapplication.htm) metadata file

<Terminal
  command={"sf project retrieve start --target-org CobaltOrg \\\n  --metadata \"ExternalClientApplication:Neptune\""}
  copyText={"ORG_ALIAS=CobaltOrg; ECA_NAME=Neptune; sf project retrieve start --target-org $ORG_ALIAS --metadata \"ExternalClientApplication:$ECA_NAME\""}></Terminal>

* Download [ExtlClntAppOauthSettings](https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_extlclntappoauthsettings.htm) metadata file

<Terminal
  command={"sf project retrieve start --target-org CobaltOrg \\\n  --metadata \"ExtlClntAppOauthSettings:Neptune_oauth\""}
  copyText={`ORG_ALIAS=CobaltOrg; ECA_NAME=Neptune; sf project retrieve start --target-org $ORG_ALIAS --metadata "ExtlClntAppOauthSettings:$\{ECA_NAME\}_oauth"`}></Terminal>

* **Inspect** the project structure after retrieval.

<Terminal
  command={"tree force-app/main/default -L 2"}
  copyText={"tree force-app/main/default -L 2"}
  output={
    <>
      force-app/main/default{"\n"}
      â”œâ”€â”€ applications{"\n"}
      â”œâ”€â”€ aura{"\n"}
      â”œâ”€â”€ classes{"\n"}
      â”œâ”€â”€ contentassets{"\n"}
      â”œâ”€â”€ externalClientApps{"\n"}
      â”‚   â””â”€â”€ Neptune.eca-meta.xml{"\n"}
      â”œâ”€â”€ extlClntAppOauthSettings{"\n"}
      â”‚   â””â”€â”€ Neptune_oauth.ecaOauth-meta.xml{"\n"}
      â”œâ”€â”€ flexipages{"\n"}
      â”œâ”€â”€ layouts{"\n"}
      â”œâ”€â”€ lwc{"\n"}
      â”œâ”€â”€ objects{"\n"}
      â”œâ”€â”€ permissionsets{"\n"}
      â”œâ”€â”€ staticresources{"\n"}
      â”œâ”€â”€ tabs{"\n"}
      â””â”€â”€ triggers{"\n"}
      {"\n"}
      14 directories, 2 files{"\n"}
    </>}></Terminal>

* Open `sfdx-project.json` file and set the namespace. For a complete explanation of available fields, see [Salesforce DX Project Configuration](https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_ws_config.htm).

* Create a managed package from the metadata in `force-app`. This step is performed only once per package.
All future changes are delivered as new package versions that trace back to this original package using `NEXT` build number.
In this example, the package is named **Ocean**.

<Terminal
  command={"sf package create --name Ocean --package-type Managed \\\n  --path force-app --target-dev-hub CobaltOrg"}
  copyText={"ORG_ALIAS=CobaltOrg; PACKAGE_NAME=Ocean; sf package create --name $PACKAGE_NAME --package-type Managed --path force-app --target-dev-hub $ORG_ALIAS"}
  output={
    <>
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”{"\n"}
      â”‚ Name       â”‚ Value              â”‚{"\n"}
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{"\n"}
      â”‚ Package Id â”‚ 0Hoak0000001DjBCAU â”‚{"\n"}
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜{"\n"}
    </>}></Terminal>

* When you run `sf` commands, Salesforce automatically adds package-related properties to your `sfdx-project.json`.
This is a good time to review and update the following fields:
  * **versionName** -- a human-readable name for this package version (Ex: "Add Neptune ECA").
  * **versionDescription** -- a short description of what's included in this release (Ex: "Introduces Neptune ECA with OAuth2").
  * **versionNumber** (optional) -- for major/minor/patch releases, you can manually update it. For incremental builds, use **NEXT**
  so the Salesforce CLI automatically increments it when **creating package versions**.

```json
{
  "packageDirectories": [
    {
      "versionName": "Add Neptune ECA",
      "versionNumber": "0.1.0.NEXT",
      "path": "force-app",
      "default": true,
      "package": "Ocean",
      "versionDescription": "Introduces Neptune ECA with Oauth2"
    }
  ],
  "name": "CobaltProject",
  "namespace": "Cobalt",
  "sfdcLoginUrl": "https://login.salesforce.com",
  "sourceApiVersion": "65.0",
  "packageAliases": {
    "Ocean": "0Hoak0000001DjBCAU"
  }
}
```

* Now create a version of the `Ocean` package with code coverage, which is **required for a full release**.

<Terminal
  command={"sf package version create --package Ocean --installation-key-bypass --code-coverage --wait 10 --target-dev-hub CobaltOrg"}
  copyText={"ORG_ALIAS=CobaltOrg; PACKAGE_NAME=Ocean; sf package version create --package $PACKAGE_NAME --installation-key-bypass --code-coverage --wait 10 --target-dev-hub $ORG_ALIAS"}
  output={
    <>
      Version create.... Create version status: Success{"\n"}
      Successfully created the package version [08cak0000004VEvAAM]. Subscriber Package Version Id: 04tak000000Mg3pAAC{"\n"}
      Package Installation URL: https://login.salesforce.com/packaging/installPackage.apexp?p0=04tak000000Mg3pAAC{"\n"}
      As an alternative, you can use the "sf package install" command.{"\n"}
      Warning: Record types defined in the scratch org definition file will stop being capitalized by default in a future release.{"\n"}
      Set the `org-capitalize-record-types` config var to `true` to enforce capitalization.{"\n"}
    </>}></Terminal>

* As shown in the output, the provided **link** can be used by a consumer **to install** this package.
Before sharing, it's best to release this package version. Otherwise, it will remain a beta version,
which cannot be updated automatically. Consumers would need to uninstall and reinstall the package for every update,
which can be cumbersome.

<Terminal
  command={"sf package version promote --package 04tak000000Mg3pAAC --target-dev-hub CobaltOrg"}
  copyText={"ORG_ALIAS=CobaltOrg; PACKAGE_VERSION=04tak000000Mg3pAAC; sf package version promote --package $PACKAGE_VERSION --target-dev-hub $ORG_ALIAS"}
  output={
    <>
      ? Are you sure you want to release package version 04tak000000Mg3pAAC? You can't undo this action. Release package (y/n)? yes{"\n"}
      Successfully promoted the package version, ID: 04tak000000Mg3pAAC, to released.{"\n"}
    </>}></Terminal>

* Finally, you can **view** all package versions for your **Dev Hub** account:

<Terminal
  command={"sf package version list --target-dev-hub CobaltOrg"}
  copyText={"ORG_ALIAS=CobaltOrg; sf package version list --target-dev-hub $ORG_ALIAS"}></Terminal>


## Install Package

As a consumer, you can install the package using several options:
* **Installation URL** -- open the URL from the previous steps in a browser.
  * Example: `https://login.salesforce.com/packaging/installPackage.apexp?p0=04tak000000Mg3pAAC`
  * General URL format: `https://login.salesforce.com/packaging/installPackage.apexp?p0=<PACKAGE_VERSION>`
* **Salesforce CLI** -- you can use `sf` commands to install the package on a scratch org, sandbox, or production org.

Let's install a package using `sf`:

* First, authorize your consumer organization using the Salesforce CLI:

<Terminal
  command={"sf org login web -d -a SubscriberOrg \\\n  --instance-url https://orgfarm-235439b2a7-dev-ed.develop.my.salesforce.com/"}
  copyText={"ORG_ALIAS=SubscriberOrg; WORKSPACE=orgfarm-235439b2a7-dev-ed.develop; sf org login web -d -a $ORG_ALIAS --instance-url https://$WORKSPACE.my.salesforce.com/"}
  output={
    <>
      Successfully authorized ******@gmail.com with org ID 00Dg5000004LGQtEAO{"\n"}
    </>
  }></Terminal>

* If you are using multiple accounts, you can list connected orgs (Ex: in our tutorial we have builder and consumer orgs):

<Terminal
  command={"sf org list"}
  copyText={"sf org list"}
  output={
    <>
      â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”{"\n"}
      â”‚    â”‚ Type â”‚ Alias       â”‚ Username           â”‚ Org Id           â”‚ Status  â”‚{"\n"}
      â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{"\n"}
      â”‚ ğŸŒ³ â”‚DevHubâ”‚CobaltOrg    â”‚ ***@gmail.com      â”‚00Dak0000094BCbEAMâ”‚Connectedâ”‚{"\n"}
      â”‚    â”‚      â”‚SubscriberOrgâ”‚ ***@agentforce.com â”‚00Dg5000004LGQtEAOâ”‚Connectedâ”‚{"\n"}
      â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜{"\n"}
      {"\n"}
      Legend:  ğŸŒ³=Default DevHub, ğŸ=Default Org      Use --all to see expired and deleted scratch orgs{"\n"}
    </>}></Terminal>

* Install the released package version to the **SubscriberOrg**:

<Terminal
  command={"sf package install --package 04tak000000Mg3pAAC --wait 10 --target-org SubscriberOrg"}
  copyText={"ORG_ALIAS=SubscriberOrg; PACKAGE_VERSION=04tak000000Mg3pAAC; sf package install --package $PACKAGE_VERSION --wait 10 --target-org $ORG_ALIAS"}
  output={
    <>
      Waiting 10 minutes for package install to complete.... done{"\n"}
      Successfully installed package [04tak000000Mg3pAAC]{"\n"}
    </>}></Terminal>

## View installed package

* Open **Setup** > **Apps** > **Packaging** > **Installed Packages**.

![View Installed Packages](/images/customer-guides/salesforce-eca/installed-packages.png)

* Click on the package name and then click **View Components** to see all metadata components included with this package.

![View Package Details](/images/customer-guides/salesforce-eca/package-details.png)

* Open the **External Client Manager**. You should now see the **Neptune** application installed.

![Installed apps](/images/customer-guides/salesforce-eca/installed-apps.png)

## Result

After completing the installation, every user in the consumer organization **can perform OAuth2 authorization** against the **Neptune** application created by the builder.


# Useful links and notes

## ECA Metadata types
Depending on how the External Client App is configured, additional metadata types may be available for download, such as:
* `ExtlClntAppConfigurablePolicies`
* `ExtlClntAppGlobalOauthSettings`
* `ExtlClntAppOauthConfigurablePolicies`
To discover all metadata currently defined in an org, you can [generate a package.xml manifest file](https://help.salesforce.com/s/articleView?id=xcloud.retrieve_data_from_the_source_org.htm&type=5)
from the source org for inspection.

## ECA Settings configuration
You may change the `[ECAPP_OAUTH_SETTINGS].ecaOauth-meta.xml` file to [configure the External Client App Oauth Settings](https://help.salesforce.com/s/articleView?id=xcloud.meta_configure_external_client_app_oauth_settings.htm&type=5).

## Scratch Organizations
Instead of pushing changes directly to production, you can use a scratch org to test your packages safely. Learn more about [creating and opening scratch orgs](https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_scratch_orgs_create.htm).
